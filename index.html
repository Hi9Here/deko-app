<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">
    <meta name="description" content="Deko Makes the Web Simple. It's as easy as that'">
    <title>Deko</title>
    <meta name="theme-color" content="#fff">
    <link rel="manifest" href="/manifest.json">
    <script src="/bower_components/firebase/firebase-app.js"></script>
    <script src="/bower_components/firebase/firebase-auth.js"></script>
    <script src="/bower_components/firebase/firebase-database.js"></script>
    <script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <link rel="import" href="/bower_components/deko-page/deko-page.html">
    <link rel="import" href="/bower_components/iron-image/iron-image.html">
    <link rel="import" href="/bower_components/app-route/app-location.html">
    <link rel="import" href="/bower_components/app-route/app-route.html">
    <link rel="import" href="/bower_components/firebase-ui-auth/firebase-ui-auth.html">
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyBT79W2ppUbnhG1cznsy7X12LY4XuJ9SwU",
        authDomain: "cards-edb54.firebaseapp.com",
        databaseURL: "https://cards-edb54.firebaseio.com",
        storageBucket: "cards-edb54.appspot.com",
        messagingSenderId: "526439963818"
      }
      try {
        firebase.initializeApp(config)
      }
      catch (e) {
       console.log(e)
       window.location.reload()
      }
    </script>
    <style>
      html, body {
        margin: 0;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <template is="dom-bind" id="app">
      <app-location route="{{route}}"></app-location>
      <app-route route="{{route}}" pattern="/:profile" data="{{data}}"></app-route>
      <app-route route="{{route}}" pattern="/:profile/:deck" data="{{data2}}"></app-route>
      <deko-page user="[[user]]" on-logout="logout" on-login="login" url-deck="{{deck}}" url-profile="{{profile}}" >
        <login-page>
          <img src="/deko-150.png"/>
          <firebase-ui-auth bugfix id="auth" user="{{user}}" photo="{{user.imageUrl}}" sign-in-success-url="" sign-in='["GoogleAuthProvider","EmailAuthProvider"]'></firebase-ui-auth>
        </login-page>
        <!-- <template is="dom-if" if="[[!user]]"> -->
        <!-- </template> -->
      </deko-page>
    </template>
  </body>
  <script>
   var app = document.querySelector('#app')
        app.properties = {
          data:{
            value: {
              profile: "",
              deck: "",
            }
          },
          data2:{
            value: {
              profile: "",
              deck: "",
            }
          },
          _profile: {
            computed:"getProfile(data.profile, data2.profile, user.uid)"
          },
          _deck: {
            computed:"getdeck(data.deck, data2.deck)"
          },
          _setRoute:{
            computed:"setRoute(route.path)"
          },
          _route: {
            computed:"addRoute(profile)"
          },
          __route: {
            computed:"addRoute(profile, deck)"
          },
          _urlParams:{
            computed:"setUrlParams(urlParams)"
          },
        }
        app.setRoute = function(path) {
          if (path) {
            if (path.split("/")[1] && path.split("/")[1] !== this.profile ) {
              this.profile = path.split("/")[1]
            } 
            if (path.split("/")[2] && path.split("/")[2] !== this.deck ) {
              this.deck = path.split("/")[2]
            } 
          }
        }
        app.addRoute = function(profile, deck){

          if (profile && this.route.path === "/" || !this.route.path.startsWith("/" + profile + "/")) {
            this.route.path = "/" + profile + "/"
          }
          
          if (profile && deck && this.route.path === "/" + profile + "/" ) {
            var path = "/" + profile + "/" + deck + "/"
            if (this.route && this.route.path && this.route.path !== path) {
              this.route.path = path
              this.set("route", JSON.parse(JSON.stringify(this.route)) )
            }
          }
        }
        app.getProfile = function(profile, profile2, uid){
          // get profile now
          return "loading"
        }
        app.getDeck = function(deck, deck2){   
          if (this.deck !== deck && this.deck !== deck2 && this.deck !== deck3 && this.deck !== "") {
            this.deck = deck || deck2 || deck3 || ""
          }
        }
   app.logout = function() { app.$.auth.signOut() }
   app.login = function() { app.$.auth.trySignIn() }
  </script>
</html>
